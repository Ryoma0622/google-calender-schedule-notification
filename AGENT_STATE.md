# Agent State Document — CalBar メニューバー表示改善

> 最終更新: 2026-02-15
> ブランチ: `claude/recursing-volhard`

---

## 1. Task Overview

メニューバーのトップバー表示を改善する。当日の予定がない場合に `--` と表示されていたのを、わかりやすい絵文字付きの表示に変更する。

## 2. Plan / TODO

- [x] `calbar/app.py` の `_update_title` メソッドを修正し、状態に応じた絵文字付き表示にする
- [x] 初期タイトルと手動更新時の表示も改善
- [x] 固定幅・表示幅制限を絵文字付きタイトルに合わせて調整

## 3. Progress / Completed Work

### 変更したファイル: `calbar/app.py`

1. **`_update_title` メソッド (L253-302)**: 表示ロジックを大幅改善
   - 予定なし: `--` → `☀️ 予定なし`
   - 全予定終了: `--` → `✅ 完了`
   - 開催中イベントの検出を追加（`🟢` で表示）
   - 次の予定あり: `📅` アイコン付きで表示
   - 開催中 + 次の予定あり: `🟢` アイコン + 次の予定時刻

2. **初期タイトル (L26)**: `"..."` → `"📅 取得中..."`

3. **手動更新時 (L363)**: `"..."` → `"🔄 更新中..."`

4. **固定幅 (L109)**: `96.0` → `120.0` — 絵文字付きタイトルの幅に対応

5. **表示幅制限 (L334)**: `12` → `16` — `_build_menubar_title` で絵文字分を考慮

## 4. Open Issues / Blockers

なし

## 5. Next Steps

コミット待ち。
